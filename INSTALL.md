# SINAS Installation Guide

## Quick Install (Recommended)

Run the automated installer on a fresh Ubuntu 22.04+ VPS:

```bash
# Clone repository
git clone https://github.com/sinas-platform/sinas-core.git
cd sinas-agents

# Run installer
sudo bash install.sh
```

The script will:
- ✅ Install Docker & Docker Compose
- ✅ Generate secure keys automatically
- ✅ Prompt for configuration (domain, SMTP, etc.)
- ✅ Create `.env` file
- ✅ Configure firewall (optional)
- ✅ Start all services
- ✅ Auto-provision SSL certificate

**That's it!** SINAS will be running at `https://your-domain.com`

---

## Manual Installation

If you prefer to configure manually:

### 1. Prerequisites

```bash
# Install Docker
curl -fsSL https://get.docker.com | sh

# Install Docker Compose
apt install docker-compose-plugin
```

### 2. Configure

```bash
# Copy example environment
cp .env.example .env

# Edit configuration
nano .env
```

**Required variables:**
```bash
SECRET_KEY=<openssl rand -hex 32>
ENCRYPTION_KEY=<python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())">
DATABASE_PASSWORD=<secure-password>
SMTP_HOST=smtp.sendgrid.net
SMTP_USER=apikey
SMTP_PASSWORD=<your-api-key>
CADDY_DOMAIN=api.yourdomain.com
ACME_EMAIL=admin@yourdomain.com
SUPERADMIN_EMAIL=admin@yourdomain.com
```

### 3. DNS Setup

Point your domain to the server:
```
A Record: api.yourdomain.com → YOUR_SERVER_IP
```

### 4. Start Services

```bash
docker compose up -d
```

### 5. Verify

```bash
curl https://api.yourdomain.com/health
# Should return: {"status":"healthy"}
```

---

## What Gets Installed

The Docker Compose stack includes:

- **sinas-app** - FastAPI application (port 8000)
- **postgres** - PostgreSQL database
- **redis** - Redis cache
- **clickhouse** - ClickHouse analytics (optional)
- **caddy** - Reverse proxy with automatic HTTPS

---

## Post-Installation

### Access API Documentation
```
https://your-domain.com/docs
```

### Login as Superadmin
1. Go to `/docs`
2. Use `/auth/login` endpoint with your superadmin email
3. Check email for OTP code
4. Use `/auth/verify-otp` to get JWT token

### View Logs
```bash
# All services
docker compose logs -f

# Specific service
docker compose logs -f sinas-app
```

### Update SINAS
```bash
git pull
docker compose up -d --build
```

### Backup Database
```bash
docker exec sinas-postgres pg_dump -U postgres sinas > backup.sql
```

---

## Troubleshooting

### SSL Not Working?
- Check DNS: `dig api.yourdomain.com`
- View Caddy logs: `docker logs sinas-caddy`
- Wait 1-2 minutes for certificate provisioning

### Services Not Starting?
```bash
docker compose ps        # Check status
docker compose logs      # View errors
```

### Database Connection Issues?
- Verify `DATABASE_PASSWORD` in `.env`
- Check if postgres is running: `docker ps | grep postgres`

### Email (OTP) Not Sending?
- Verify SMTP credentials in `.env`
- Check app logs: `docker compose logs sinas-app | grep SMTP`

---

## Minimum Requirements

- **OS:** Ubuntu 22.04+ (or any Linux with Docker support)
- **RAM:** 2GB minimum, 4GB recommended
- **CPU:** 2 cores minimum
- **Storage:** 50GB minimum
- **Ports:** 80, 443, 22 (SSH)

---

## Security Recommendations

1. **Use strong passwords** - Auto-generated by install script
2. **Configure firewall** - Script configures UFW automatically
3. **Keep updated** - Run `git pull && docker compose up -d --build` regularly
4. **Backup regularly** - Set up automated database backups
5. **Use SSH keys** - Disable password authentication for SSH

---

## Support

- **Documentation:** https://docs.sinas.io (coming soon)
- **Issues:** https://github.com/pulsr-one/sinas-agents/issues
- **Discord:** (coming soon)
